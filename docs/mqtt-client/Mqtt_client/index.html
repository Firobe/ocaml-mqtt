<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mqtt_client (mqtt-client.Mqtt_client)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">mqtt-client</a> &#x00BB; Mqtt_client</nav><h1>Module <code>Mqtt_client</code></h1></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>t</span></code></dt><dd><p>Represents an MQTT client.</p><p>To create a new client use <a href="index.html#val-connect"><code>Mqtt_client.connect</code></a>.</p></dd></dl><dl><dt class="spec type" id="type-credentials"><a href="#type-credentials" class="anchor"></a><code><span class="keyword">type</span> <span>credentials</span></code><code> = </code><table class="variant"><tr id="type-credentials.Credentials" class="anchored"><td class="def constructor"><a href="#type-credentials.Credentials" class="anchor"></a><code>| </code><code><span class="constructor">Credentials</span>(string, string)</code></td></tr><tr id="type-credentials.Username" class="anchored"><td class="def constructor"><a href="#type-credentials.Username" class="anchor"></a><code>| </code><code><span class="constructor">Username</span>(string)</code></td></tr></table></dt><dd><p>Client authentication credentials.</p><p>MQTT supports two authentication methods: username with password, or username only.</p><p>The credentials will be sent in plain text, unless TLS is used. See <a href="index.html#val-connect"><span>connection options</span></a> for more information.</p></dd></dl><dl><dt class="spec type" id="type-qos"><a href="#type-qos" class="anchor"></a><code><span class="keyword">type</span> <span>qos</span></code><code> = </code><table class="variant"><tr id="type-qos.Atmost_once" class="anchored"><td class="def constructor"><a href="#type-qos.Atmost_once" class="anchor"></a><code>| </code><code><span class="constructor">Atmost_once</span></code></td></tr><tr id="type-qos.Atleast_once" class="anchored"><td class="def constructor"><a href="#type-qos.Atleast_once" class="anchor"></a><code>| </code><code><span class="constructor">Atleast_once</span></code></td></tr><tr id="type-qos.Exactly_once" class="anchored"><td class="def constructor"><a href="#type-qos.Exactly_once" class="anchor"></a><code>| </code><code><span class="constructor">Exactly_once</span></code></td></tr></table></dt><dd><p>Quality of Service level.</p><p>Defines the guarantee of delivery for messages.</p></dd></dl><dl><dt class="spec value" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span class="keyword">let</span> connect: <span class="arg">?&#8288;<span class="label">id</span>:string <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">tls_ca</span>:string <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">credentials</span>:<a href="index.html#type-credentials">credentials</a> <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">will</span>:<span>(string, string)</span> <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">clean_session</span>:bool <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">keep_alive</span>:int <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">ping_timeout</span>:float <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">on_error</span>:<span>(<span class="arg"><a href="index.html#type-t">t</a> <span>=&gt;</span> </span><span class="arg">exn <span>=&gt;</span> </span><span>Lwt.t(unit)</span>)</span> <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">port</span>:int <span>=&gt;</span> </span><span class="arg"><span>list(string)</span> <span>=&gt;</span> </span><span>Lwt.t(<a href="index.html#type-t">t</a>)</span></code></dt><dd><p>Connects to the MQTT broker.</p><p>Multiple hosts can be provided in case the broker supports failover. The client will attempt to connect to each one of hosts sequentially until one of them is successful.</p><p><code>on_error</code> can be provided to handle errors during client's execution. By default all internal exceptions will be raised with <code>Lwt.fail</code>.</p><p><i>Note:</i> Reconnection logic is not implemented currently.</p><pre><code class="ml">let broker_hosts = [&quot;host-1&quot;, &quot;host-2&quot;];
let%lwt client = Mqtt_client.connect(~id=&quot;my-client&quot;, ~port=1883, broker_hosts);</code></pre></dd></dl><dl><dt class="spec value" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span class="keyword">let</span> disconnect: <span class="arg"><a href="index.html#type-t">t</a> <span>=&gt;</span> </span><span>Lwt.t(unit)</span></code></dt><dd><p>Disconnects the client from the MQTT broker.</p><pre><code class="ml">let%lwt () = Mqtt_client.disconnect(client);</code></pre></dd></dl><dl><dt class="spec value" id="val-publish"><a href="#val-publish" class="anchor"></a><code><span class="keyword">let</span> publish: <span class="arg">?&#8288;<span class="label">dup</span>:bool <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">qos</span>:<a href="index.html#type-qos">qos</a> <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">retain</span>:bool <span>=&gt;</span> </span><span class="arg"><span class="label">topic</span>:string <span>=&gt;</span> </span><span class="arg">string <span>=&gt;</span> </span><span class="arg"><a href="index.html#type-t">t</a> <span>=&gt;</span> </span><span>Lwt.t(unit)</span></code></dt><dd><p>Publish a message with payload to a given topic.</p><pre><code class="ml">let payload = &quot;Hello world&quot;;
let%lwt () = Mqtt_client.publish(~topic=&quot;news&quot;, payload, client);</code></pre></dd></dl><dl><dt class="spec value" id="val-subscribe"><a href="#val-subscribe" class="anchor"></a><code><span class="keyword">let</span> subscribe: <span class="arg">?&#8288;<span class="label">dup</span>:bool <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">qos</span>:<a href="index.html#type-qos">qos</a> <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">retain</span>:bool <span>=&gt;</span> </span><span class="arg">?&#8288;<span class="label">id</span>:int <span>=&gt;</span> </span><span class="arg"><span>list(<span>(string, <a href="index.html#type-qos">qos</a>)</span>)</span> <span>=&gt;</span> </span><span class="arg"><a href="index.html#type-t">t</a> <span>=&gt;</span> </span><span>Lwt.t(unit)</span></code></dt><dd><p>Subscribes the client to a list of topics.</p><pre><code class="ml">let topics = [
  (&quot;news/fashion&quot;, Mqtt_client.Atmost_once),
  (&quot;news/science&quot;, Mqtt_client.Atleast_once)
];
let%lwt () = Mqtt_client.subscribe(topics, client);</code></pre></dd></dl><dl><dt class="spec value" id="val-messages"><a href="#val-messages" class="anchor"></a><code><span class="keyword">let</span> messages: <span class="arg"><a href="index.html#type-t">t</a> <span>=&gt;</span> </span><span>Lwt_stream.t(<span>(string, string)</span>)</span></code></dt><dd><p>A stream of messages for all subscriptions.</p><p>The stream contains pairs with a topic and the message payload.</p><pre><code class="ml">let messages = Mqtt_client.messages(client);
let%lwt () = Lwt_stream.iter(
  (topic, payload) =&gt; print_endline(payload),
  messages
);</code></pre></dd></dl></div></body></html>